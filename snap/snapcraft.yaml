name: prismlauncher
license: GPL-3.0-only
base: core24
website: https://prismlauncher.org/
source-code: https://github.com/PrismLauncher/PrismLauncher
issues: https://github.com/PrismLauncher/PrismLauncher/issues
donation: https://opencollective.com/prismlauncher
contact: https://prismlauncher.org/discord
summary: A custom Minecraft launcher with modpack support
adopt-info: prismlauncher

grade: devel
confinement: strict

platforms:
  amd64:
  arm64:

parts:
  prismlauncher:
    source: https://github.com/PrismLauncher/PrismLauncher.git
    source-tag: "10.0.5-pre1"
    parse-info:
      - usr/share/metainfo/org.prismlauncher.PrismLauncher.metainfo.xml
    plugin: cmake
    cmake-generator: Ninja
    cmake-parameters:
      - "-DCMAKE_INSTALL_PREFIX=/usr"
      - "-DCMAKE_BUILD_TYPE=RelWithDebInfo"
      - "-DENABLE_LTO=ON"
      - "-DLauncher_BUILD_PLATFORM=snap"
      - "-DLauncher_QT_VERSION_MAJOR='6'"
    override-pull: |
      craftctl default
      # Fix the icon reference in the desktop file
      sed -i.bak -e 's|Icon=org.prismlauncher.PrismLauncher|Icon=/usr/share/icons/hicolor/scalable/apps/org.prismlauncher.PrismLauncher.svg|g' program_info/org.prismlauncher.PrismLauncher.desktop.in
      # Remove the build directory so that local development doesn't interfere with Snap compilation
      rm -rf build
      git submodule update --init --recursive
    build-packages:
      - zlib1g-dev
      - openjdk-17-jdk
      - scdoc
      - libgl1-mesa-dev
      - extra-cmake-modules
      - cmark
      - libcmark-dev
      - gamemode
      - gamemode-dev
      - libqrencode-dev
      - libarchive-dev
      - libtomlplusplus-dev
      - libxkbcommon-dev
    build-snaps:
      - kde-qt6-core24-sdk
    stage-packages:
      - openjdk-25-jre
      - openjdk-21-jre
      - openjdk-17-jre
      - openjdk-8-jre
      - libtomlplusplus3t64
      - libcmark0.30.2
      - gamemode

apps:
  prismlauncher:
    common-id: org.prismlauncher.PrismLauncher
    desktop: usr/share/applications/org.prismlauncher.PrismLauncher.desktop
    command: usr/bin/prismlauncher
    extensions:
      - kde-neon-6
    environment:
      PRISMLAUNCHER_DATA_DIR: "$SNAP_USER_COMMON/PrismLauncher"
      LD_LIBRARY_PATH: "$LD_LIBRARY_PATH:$SNAP/usr/lib/x86_64-linux-gnu:$SNAP/usr/lib/i386-linux-gnu"
    plugs:
      - home
      - opengl
      - network
      - network-bind
      - audio-playback
